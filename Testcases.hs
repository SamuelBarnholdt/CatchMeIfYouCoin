import System.IO
import Wallets
import Cryptography
import TransactionsandBlockchain
import TransactionandBlockchainTypes
import InputOutputs
import Control.Exception
import Data.Char
import System.Directory
import Test.HUnit
import Test.QuickCheck
import SHA3_256




test1 = TestCase $ assertBool "Verifies valid transaction" (verifyTransaction testledger testtransaction)
test2 = TestCase $ assertBool "Verifies valid UBlock" (verifyBlock (createUBlock testtransaction) testledger)
test3 = TestCase $ assertBool "Double spending" (not $ verifyBlock (addTransactionToUBlock testtransaction (createUBlock testtransaction)) testledger)
test4 = TestCase $ assertEqual "Double spending in two different blocks"  (addBlock (createUBlock testtransaction) testledger) (addBlock  (createUBlock testtransaction) (addBlock (createUBlock testtransaction) testledger))
test5 = TestCase $ assertBool "Testing valid ledger " (verifyState $ addBlock (createUBlock testtransaction) testledger)
test6 = TestCase $ assertBool "Testing invalid ledger" (not $ verifyState hugeinvalidledger)
test7 =
    let s = (("ye","123"),[(("name","password"),(1,(1,2)))])
    in
      TestCase $ assertEqual "verifyAccount" False (verifyAccount (fst s) (snd s))

test8 =
    let s = (("y","y"),[])
    in
      TestCase $ assertEqual "verifyAccount" False (verifyAccount (fst s) (snd s))


test9 = TestCase $ assertEqual "genPrivateKey" 77 (length (show (genPrivateKey "d")))

test10 = TestCase $ assertEqual "containsCharacters" True (containsCharacters " ")


test11 = TestCase $ assertEqual "rotation" ([(1,1),(2,2),(3,3),(4,4),(0,5)]) (rotatel [1,2,3,4,5] 1 0 5)
test12 = TestCase $ assertEqual "rotation" ([(3,1),(4,2),(5,3),(6,4),(7,5),(0,6),(1,7),(2,8)]) (rotatel [1,2,3,4,5,6,7,8] 3 0 8)

runtests = runTestTT $ TestList [test1,test2,test3,test4,test6,test7,test8,test9,test10,test11,test12]


--------------------------------------------------------------------------------
-- Things we test

testledger = [Block 0 0 [VerifiedTransaction 0 [((0,0),500,0,0,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)]]]

testtransaction = createTransaction [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)] [(testpubkey2,250)] testpvtkey1

hugevalidledger = [Block 0 0 [VerifiedTransaction 0 [((0,0),500,0,0,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)]],Block 1 99735830416468970104092670904400334572434862601712227001343038942300374523342 [VerifiedTransaction 0 [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0),((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)]],Block 2 16335718410221131335894625344441953130129513711493226094974349642920046479962 [VerifiedTransaction 0 [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),147,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,0),((73846324497674902366523307101099675294999402379009558830370129385155781475584,82858464721404851659637251483484007143464613997680829280269153447618446116770),103,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,0)],VerifiedTransaction 1 [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)] [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),159,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1),((73846324497674902366523307101099675294999402379009558830370129385155781475584,82858464721404851659637251483484007143464613997680829280269153447618446116770),39,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1),((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),52,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1)]],Block 3 3754521091262849863853024566025447216367250913911757199330108930223486795032 [VerifiedTransaction 0 [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),159,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),159,3754521091262849863853024566025447216367250913911757199330108930223486795032,3,0)]]]

hugeinvalidledger = [Block 0 0 [VerifiedTransaction 0 [((0,0),500,0,0,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)]],Block 1 99735830416468970104092670904400334572434862601712227001343038942300374523342 [VerifiedTransaction 0 [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),500,0,0,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0),((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)]],Block 2 16335718410221131335894625344441953130129513711493226094974349642920046479962 [VerifiedTransaction 0 [((4060523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),147,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,0),((73846324497674902366523307101099675294999402379009558830370129385155781475584,82858464721404851659637251483484007143464613997680829280269153447618446116770),103,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,0)],VerifiedTransaction 1 [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),250,99735830416468970104092670904400334572434862601712227001343038942300374523342,1,0)] [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),159,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1),((73846324497674902366523307101099675294999402379009558830370129385155781475584,82858464721404851659637251483484007143464613997680829280269153447618446116770),39,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1),((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),52,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1)]],Block 3 3754521091262849863853024566025447216367250913911757199330108930223486795032 [VerifiedTransaction 0 [((112665805890443947137552868105091646615063718271004891690500396267340677150464,36940215344124244177866093169966123336154856569486143389123476421148634528516),159,16335718410221131335894625344441953130129513711493226094974349642920046479962,2,1)] [((40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193),159,3754521091262849863853024566025447216367250913911757199330108930223486795032,3,0)]]]





testpubkey1 = (40680523468039240765912284909371071905755387814877247228281539266779759224231,54149417469973453946738899702735093324325421986795722149863721966552839094193)
testpvtkey1 = 85031446153070797826286950818799642722766467813342259709606071427982234227642


testpubkey2 = (73846324497674902366523307101099675294999402379009558830370129385155781475584,82858464721404851659637251483484007143464613997680829280269153447618446116770)
testpvtkey2 = 7544662337582413966390300095045928043661972512515898329428179999616726931881
